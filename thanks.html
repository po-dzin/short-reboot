<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Дякуємо! Оплату успішно прийнято</title>

  <!-- ✅ Meta Pixel (BASE) -->
  <script>
  !function(f,b,e,v,n,t,s)
  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};
  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
  n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];
  s.parentNode.insertBefore(t,s)}(window, document,'script',
  'https://connect.facebook.net/en_US/fbevents.js');

  fbq('init', '885125430564169');      /* <-- ЗАМЕНИ на свой Pixel ID */
  fbq('track', 'PageView');
  </script>
  <noscript>
    <img height="1" width="1" style="display:none"
      src="https://www.facebook.com/tr?id=885125430564169&ev=PageView&noscript=1"/>
  </noscript>
  <!-- ✅ End Meta Pixel (BASE) -->

  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; }
    .wrap { max-width: 760px; margin: 0 auto; padding: 48px 18px; }
    .card { border: 1px solid #e7e7e7; border-radius: 16px; padding: 22px; }
    h1 { font-size: 28px; margin: 0 0 8px; }
    p { margin: 10px 0; line-height: 1.5; color: #222; }
    .muted { color: #666; font-size: 14px; }
    .btns { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 16px; }
    a.btn { display: inline-block; padding: 12px 16px; border-radius: 12px; text-decoration: none; border: 1px solid #111; color: #111; }
    a.btn.primary { background: #111; color: #fff; }
    code { background: #f6f6f6; padding: 2px 6px; border-radius: 8px; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <h1>✅ Дякуємо! Оплату успішно прийнято</h1>
      <p>Доступ до курсу вже готується. Якщо бот не відкрився автоматично — натисніть кнопку нижче.</p>

      <div class="btns">
        <!-- (опционально) замени ссылку на своего TG-бота -->
        <a class="btn primary" href="https://t.me/ShortRebootBot?start=ZGw6MjA1MTc3" target="_blank" rel="noopener">Відкрити бот</a>
        <a class="btn" href="https://reboot.centerway.net.ua/">Повернутися на сайт</a>
      </div>

      <p class="muted" id="orderLine">Завантаження даних платежу…</p>
      <p class="muted">Якщо щось пішло не так — напишіть у підтримку.</p>
    </div>
  </div>

  <!-- ✅ Purchase event -->
  <script>
  (function () {
    // защита от двойного срабатывания (например, если страница перезагрузилась)
    if (sessionStorage.getItem('cw_purchase_fired') === '1') return;

    const qs = new URLSearchParams(location.search);

    // Подстрой под то, что реально прилетит от Liqpay:
    // пример: ?order_id=123 или ?payment_id=abc
    const tid = qs.get('order_id') || qs.get('payment_id') || qs.get('id') || '';

    // (опционально) вытянуть сохранённую атрибуцию
    let attrib = {};
    try { attrib = JSON.parse(localStorage.getItem('cw_attrib') || '{}'); } catch (_) {}

    // UI строка
    const orderLine = document.getElementById('orderLine');
    orderLine.textContent = tid
      ? `Номер платежу: ${tid}`
      : `Номер платежу: (не передано в URL)`;

    // ⚠️ ВАЖНО: value/currency должны совпадать с реальной оплатой
    const payload = {
      value: 350,
      currency: 'UAH',
      content_name: 'Short Reboot'
    };

    // transaction_id лучше передавать, если он есть
    if (tid) payload.transaction_id = tid;

    // можно отправить атрибуцию как доп. поля (не обязательно, но полезно для дебага)
    // Meta может их игнорировать, это нормально.
    Object.assign(payload, attrib);

    if (typeof fbq === 'function') {
      fbq('track', 'Purchase', payload);
      sessionStorage.setItem('cw_purchase_fired', '1');
    }
  })();
  </script>
  
  <script>
  // автопереход в бот через 1.2 сек (кнопка остаётся как запасной вариант)
  setTimeout(() => {
    window.location.href = "https://t.me/ShortRebootBot?start=ZGw6MjA1MTc3";
  }, 1200);
</script>
  
</body>
</html>
